spring:
  application:
    name: agent-demo
  profiles:
    active: ${SPRING_PROFILE:local}

  # Jackson 配置（支持 Java 8 时间类型）
  jackson:
    serialization:
      write-dates-as-timestamps: false
    default-property-inclusion: non_null

  # 通用 JPA 配置
  jpa:
    open-in-view: false

  # Redis 配置
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DB:0}
      timeout: 1000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: 500ms

  # Actuator 配置（监控和健康检查）
  management:
    endpoints:
      web:
        exposure:
          include: health,info,prometheus,metrics
        base-path: /actuator
    endpoint:
      health:
        show-details: when-authorized
    metrics:
      export:
        prometheus:
          enabled: true
    prometheus:
      metrics:
        export:
          enabled: true

server:
  port: ${SERVER_PORT:8090}
  shutdown: graceful
  tomcat:
    max-threads: 200
    accept-count: 100

# Agent 通用配置
agent:
  security:
    enabled: ${AGENT_SECURITY_ENABLED:true}  # 生产环境必须启用
    api-key: ${AGENT_API_KEY:}  # 必须通过环境变量配置，无默认值
    api-key-secondary: ${AGENT_API_KEY_SECONDARY:}  # 备用 API Key，用于轮换
    require-prefix: ${AGENT_SECURITY_REQUIRE_PREFIX:true}  # 要求 API Key 以 sk- 开头
    # 速率限制配置
    rate-limit:
      enabled: ${AGENT_RATE_LIMIT_ENABLED:true}
      capacity: ${AGENT_RATE_LIMIT_CAPACITY:20}  # 令牌桶容量
      refill-tokens: ${AGENT_RATE_LIMIT_REFILL:20}  # 每分钟补充的令牌数
      period: ${AGENT_RATE_LIMIT_PERIOD:60}  # 补充周期（秒）
  model:
    provider: ${AGENT_MODEL_PROVIDER:openai}
  # 对话历史配置
  history:
    enabled: ${AGENT_HISTORY_ENABLED:true}  # 是否启用对话历史
    max-messages: ${AGENT_HISTORY_MAX_MESSAGES:20}  # 最大历史消息条数
    max-tokens: ${AGENT_HISTORY_MAX_TOKENS:4000}  # 最大历史 token 数量（避免超出模型限制）
    recent-first: ${AGENT_HISTORY_RECENT_FIRST:true}  # 优先保留最近的消息

# Spring AI 配置（所有环境共享）
spring.ai:
  # 阿里云通义千问配置
  openai:
    base-url: https://dashscope.aliyuncs.com/compatible-mode
    api-key: ${AI_API_KEY:}
    chat:
      model: ${AI_MODEL:qwen-max}
      temperature: ${AI_TEMPERATURE:0.7}
      max-tokens: ${AI_MAX_TOKENS:2000}

  # 本地 Ollama 配置
  ollama:
    base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
    chat:
      model: ${OLLAMA_MODEL:qwen2.5:7b}
      temperature: ${OLLAMA_TEMPERATURE:0.7}

# 日志配置
logging:
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'
  level:
    root: INFO
    cn.chollter.agent.demo: ${LOG_LEVEL:INFO}
  file:
    name: ${LOG_FILE:logs/agent-demo.log}
    max-size: 100MB
    max-history: 30
